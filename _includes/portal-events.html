<template id="template-portal-event-snippet" style="display:none;">
  <div class="row">
    <div class="medium-4 columns t10">
      <a href="--URL--" target="_blank">
        <img src="--IMG--">
      </a>
    </div>
    <div class="medium-8 columns">
      <a href="--URL--" target="_blank">
        <h3 class="t10">
          <small class="subheader">--SUBHEADER--</small><br>
          --HEADER--
        </h3>
      </a>
      <p>--EXCERPT--</p>
      <p>
        <a href="--URL--" target="_blank">Read More&nbsp;â€º</a>
      </p>
    </div>
  </div>
</template>

<div class="row cols_s-1 cols_m-1 cols-1 cols-left-2">
  <div class="columns small-12 medium-12 large-12">
    <div id="portal-events">
      <p class="text-center">Loading...</p>
    </div>
  </div>
</div>

  <script>
    (function() {
      function renderPortalEvents() {
        var template = $('#template-portal-event-snippet');
        var eventsWrapper = $('#portal-events');
        $.getJSON('https://us-central1-custportal-3000.cloudfunctions.net/api/data/events', function(events) {
          eventsWrapper.html('');
          events = events.sort(function(a,b) {return a.start_date < b.start_date && 1 || -1});
          for (var i = 0, l = events.length; i<l; ++i) {
            var event = events[i];
            console.log(event);
            var el = template.html()
              .replace(/--URL--/g, 'https://portal.blackpepperswing.com/courses/' + event.id)
              .replace(/--IMG--/g, event.meta.image_src)
              .replace(/--SUBHEADER--/g, new Date(event.start_date).toLocaleDateString('FI') + ' - ' + new Date(event.last_date).toLocaleDateString('FI') + ', ' + event.meta.duration)
              .replace(/--HEADER--/g, event.name)
              .replace(/--EXCERPT--/g, event.meta.description);
            eventsWrapper.append(el);
          }
        });
      }
      var a = setInterval( function() {
        if ( typeof window.jQuery === 'undefined' ) {
          return;
        }
        clearInterval( a );
        renderPortalEvents();
      }, 500 );
    })();
  </script>
